<!DOCTYPE html><html><head><title>BufferedImage与byte[]互转</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style>
.note-content  {font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif;}

</style></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-3259" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-3260" class="wmd-preview-section preview-content">

<h2 id="bufferedimage与byte互转">BufferedImage与byte[]互转</h2>

<div><div class="toc"><div class="toc">
<ul>
<li><ul>
<li><a href="#bufferedimage与byte互转">BufferedImage与byte[]互转</a><ul>
<li><a href="#需要用到的类">需要用到的类</a></li>
<li><a href="#为什么要将bufferedimage转为byte数组">为什么要将BufferedImage转为byte数组</a></li>
<li><a href="#如何取得bufferedimage">如何取得BufferedImage</a></li>
<li><a href="#bufferedimage-byte">BufferedImage  —-&gt;byte[]</a></li>
<li><a href="#byte-bufferedimage">byte[] ——&gt;BufferedImage</a></li>
<li><a href="#显示bufferedimage">显示BufferedImage</a></li>
<li><a href="#实例">实例</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>

</div><div id="wmd-preview-section-3261" class="wmd-preview-section preview-content">

<h3 id="需要用到的类">需要用到的类</h3>

<p>Java.awt.image.BufferedImage; <br>
javax.imageio.ImageIO; <br>
java.io.*;</p>

</div><div id="wmd-preview-section-3262" class="wmd-preview-section preview-content">

<h3 id="为什么要将bufferedimage转为byte数组">为什么要将BufferedImage转为byte数组</h3>

<p>在传输中，图片是不能直接传的，因此需要把图片变为字节数组，然后传输比较方便；只需要一般输出流的write方法即可； <br>
而字节数组变成BufferedImage能够还原图像；</p>

</div><div id="wmd-preview-section-3263" class="wmd-preview-section preview-content">

<h3 id="如何取得bufferedimage">如何取得BufferedImage</h3>

<p>BufferedImage image = ImageIO.read(new File(“1.gif”));</p>

</div><div id="wmd-preview-section-3264" class="wmd-preview-section preview-content">

<h3 id="bufferedimage-byte">BufferedImage  —-&gt;byte[]</h3>

<p>ImageIO.write(BufferedImage image,String format,OutputStream out);方法可以很好的解决问题； <br>
参数image表示获得的BufferedImage； <br>
参数format表示图片的格式，比如“gif”等； <br>
参数out表示输出流，如果要转成Byte数组，则输出流为ByteArrayOutputStream即可； <br>
执行完后，只需要toByteArray()就能得到byte[];</p>

</div><div id="wmd-preview-section-3265" class="wmd-preview-section preview-content">

<h3 id="byte-bufferedimage">byte[] ——&gt;BufferedImage</h3>

<p>ByteArrayInputStream in = new ByteArrayInputStream(byte[]b);    //将b作为输入流； <br>
BufferedImage image = ImageIO.read(InputStream in);     //将in作为输入流，读取图片存入image中，而这里in可以为ByteArrayInputStream();</p>

</div><div id="wmd-preview-section-3266" class="wmd-preview-section preview-content">

<h3 id="显示bufferedimage">显示BufferedImage</h3>

<p>public void paint(Graphics g){ <br>
super.paint(g); <br>
g.drawImage(image,x,y,width,height,null);    //image为BufferedImage类型 <br>
} <br>
如果要自动调用paint方法，则需要调用repaint()方法；</p>

</div><div id="wmd-preview-section-3267" class="wmd-preview-section preview-content">

<h3 id="实例">实例</h3>

<p>要求：编写一个网络程序，通过Socket将图片从服务器端传到客户端，并存入文件系统； <br>
Server端：</p>

</div><div id="wmd-preview-section-3268" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="language-java hljs"><span class="hljs-comment line-number">1.</span><span class="hljs-keyword">package</span> org.exam3;  <br><span class="hljs-comment line-number">2.</span><br><span class="hljs-comment line-number">3.</span><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;  <br><span class="hljs-comment line-number">4.</span><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;  <br><span class="hljs-comment line-number">5.</span><span class="hljs-keyword">import</span> java.io.DataOutputStream;  <br><span class="hljs-comment line-number">6.</span><span class="hljs-keyword">import</span> java.io.File;  <br><span class="hljs-comment line-number">7.</span><span class="hljs-keyword">import</span> java.net.ServerSocket;  <br><span class="hljs-comment line-number">8.</span><span class="hljs-keyword">import</span> java.net.Socket;  <br><span class="hljs-comment line-number">9.</span><br><span class="hljs-comment line-number">10.</span><span class="hljs-keyword">import</span> javax.imageio.ImageIO;  <br><span class="hljs-comment line-number">11.</span><br><span class="hljs-comment line-number">12.</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T6Server</span> </span>{  <br><span class="hljs-comment line-number">13.</span><br><span class="hljs-comment line-number">14.</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{  <br><span class="hljs-comment line-number">15.</span>        ServerSocket server = <span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">8889</span>);  <br><span class="hljs-comment line-number">16.</span>        System.out.println(<span class="hljs-string">"服务器开启连接...端口为8889"</span>);  <br><span class="hljs-comment line-number">17.</span>        Socket s = server.accept();  <br><span class="hljs-comment line-number">18.</span>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>){  <br><span class="hljs-comment line-number">19.</span>            System.out.println(<span class="hljs-string">"一客户端连接服务器，服务器传输图片..."</span>);  <br><span class="hljs-comment line-number">20.</span>            DataOutputStream dout = <span class="hljs-keyword">new</span> DataOutputStream(s.getOutputStream());  <br><span class="hljs-comment line-number">21.</span>            BufferedImage image = ImageIO.read(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"1.gif"</span>));  <span class="hljs-comment">//读取1.gif并传输  </span><br><span class="hljs-comment line-number">22.</span>            ByteArrayOutputStream out = <span class="hljs-keyword">new</span> ByteArrayOutputStream();  <br><span class="hljs-comment line-number">23.</span>            <span class="hljs-keyword">boolean</span> flag = ImageIO.write(image, <span class="hljs-string">"gif"</span>, out);  <br><span class="hljs-comment line-number">24.</span>            <span class="hljs-keyword">byte</span>[] b = out.toByteArray();  <br><span class="hljs-comment line-number">25.</span>            dout.write(b);  <br><span class="hljs-comment line-number">26.</span>            s.close();  <br><span class="hljs-comment line-number">27.</span>            System.out.println(<span class="hljs-string">"图片传送完毕,服务器开启连接...端口为8889"</span>);  <br><span class="hljs-comment line-number">28.</span>            s = server.accept();  <br><span class="hljs-comment line-number">29.</span><br><span class="hljs-comment line-number">30.</span>        }  <br><span class="hljs-comment line-number">31.</span>    }  <br><span class="hljs-comment line-number">32.</span>}  <br></code></pre>

<p>Client端：</p>

</div><div id="wmd-preview-section-3269" class="wmd-preview-section preview-content">

<pre class="prettyprint with-line-number hljs-dark"><code class="language-java hljs"><span class="hljs-comment line-number">1.</span><span class="hljs-keyword">package</span> org.exam3;  <br><span class="hljs-comment line-number">2.</span><br><span class="hljs-comment line-number">3.</span><span class="hljs-keyword">import</span> java.awt.BorderLayout;  <br><span class="hljs-comment line-number">4.</span><span class="hljs-keyword">import</span> java.awt.Graphics;  <br><span class="hljs-comment line-number">5.</span><span class="hljs-keyword">import</span> java.awt.event.ActionEvent;  <br><span class="hljs-comment line-number">6.</span><span class="hljs-keyword">import</span> java.awt.event.ActionListener;  <br><span class="hljs-comment line-number">7.</span><span class="hljs-keyword">import</span> java.awt.image.BufferedImage;  <br><span class="hljs-comment line-number">8.</span><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;  <br><span class="hljs-comment line-number">9.</span><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;  <br><span class="hljs-comment line-number">10.</span><span class="hljs-keyword">import</span> java.io.DataInputStream;  <br><span class="hljs-comment line-number">11.</span><span class="hljs-keyword">import</span> java.io.File;  <br><span class="hljs-comment line-number">12.</span><span class="hljs-keyword">import</span> java.io.PrintWriter;  <br><span class="hljs-comment line-number">13.</span><span class="hljs-keyword">import</span> java.net.Socket;  <br><span class="hljs-comment line-number">14.</span><br><span class="hljs-comment line-number">15.</span><span class="hljs-keyword">import</span> javax.imageio.ImageIO;  <br><span class="hljs-comment line-number">16.</span><span class="hljs-keyword">import</span> javax.swing.JButton;  <br><span class="hljs-comment line-number">17.</span><span class="hljs-keyword">import</span> javax.swing.JFrame;  <br><span class="hljs-comment line-number">18.</span><span class="hljs-keyword">import</span> javax.swing.JPanel;  <br><span class="hljs-comment line-number">19.</span><br><span class="hljs-comment line-number">20.</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T6Client</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JFrame</span> </span>{  <br><span class="hljs-comment line-number">21.</span>    JButton button;  <br><span class="hljs-comment line-number">22.</span>    JPanel panel;  <br><span class="hljs-comment line-number">23.</span>    <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;  <br><span class="hljs-comment line-number">24.</span>    BufferedImage image ;  <br><span class="hljs-comment line-number">25.</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">T6Client</span><span class="hljs-params">()</span> </span>{  <br><span class="hljs-comment line-number">26.</span>        setSize(<span class="hljs-number">300</span>, <span class="hljs-number">400</span>);  <br><span class="hljs-comment line-number">27.</span>        button = <span class="hljs-keyword">new</span> JButton(<span class="hljs-string">"获取图像"</span>);  <br><span class="hljs-comment line-number">28.</span>        add(button,BorderLayout.NORTH);  <br><span class="hljs-comment line-number">29.</span>        button.addActionListener(<span class="hljs-keyword">new</span> ActionListener() {  <br><span class="hljs-comment line-number">30.</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">actionPerformed</span><span class="hljs-params">(ActionEvent event)</span> </span>{  <br><span class="hljs-comment line-number">31.</span>                <span class="hljs-keyword">try</span> {  <br><span class="hljs-comment line-number">32.</span>                    Socket s = <span class="hljs-keyword">new</span> Socket(<span class="hljs-string">"localhost"</span>,<span class="hljs-number">8889</span>);  <br><span class="hljs-comment line-number">33.</span>                    PrintWriter out = <span class="hljs-keyword">new</span> PrintWriter(s.getOutputStream());  <br><span class="hljs-comment line-number">34.</span>                    out.print(<span class="hljs-string">"a"</span>);  <br><span class="hljs-comment line-number">35.</span>                    DataInputStream in = <span class="hljs-keyword">new</span> DataInputStream(s.getInputStream());  <br><span class="hljs-comment line-number">36.</span>                    <span class="hljs-keyword">byte</span>[]b = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];  <br><span class="hljs-comment line-number">37.</span>                    ByteArrayOutputStream bout = <span class="hljs-keyword">new</span> ByteArrayOutputStream();  <br><span class="hljs-comment line-number">38.</span>                    <span class="hljs-keyword">int</span> length = <span class="hljs-number">0</span>;  <br><span class="hljs-comment line-number">39.</span>                    <span class="hljs-keyword">while</span>((length=in.read(b))!=-<span class="hljs-number">1</span>){  <br><span class="hljs-comment line-number">40.</span>                        bout.write(b, <span class="hljs-number">0</span>, length);  <br><span class="hljs-comment line-number">41.</span>                    }  <br><span class="hljs-comment line-number">42.</span>                    ByteArrayInputStream bin = <span class="hljs-keyword">new</span> ByteArrayInputStream(bout.toByteArray());  <br><span class="hljs-comment line-number">43.</span>                    image = ImageIO.read(bin);  <br><span class="hljs-comment line-number">44.</span>                    repaint();  <br><span class="hljs-comment line-number">45.</span>                    ImageIO.write(image, <span class="hljs-string">"gif"</span>, <span class="hljs-keyword">new</span> File(<span class="hljs-string">"output-"</span>+count+<span class="hljs-string">".gif"</span>));  <br><span class="hljs-comment line-number">46.</span>                    count++;  <br><span class="hljs-comment line-number">47.</span>                    s.close();  <br><span class="hljs-comment line-number">48.</span>                } <span class="hljs-keyword">catch</span> (Exception e) {  <br><span class="hljs-comment line-number">49.</span>                }  <br><span class="hljs-comment line-number">50.</span>            }  <br><span class="hljs-comment line-number">51.</span>        });  <br><span class="hljs-comment line-number">52.</span>        panel = <span class="hljs-keyword">new</span> JPanel();  <br><span class="hljs-comment line-number">53.</span>        add(panel);  <br><span class="hljs-comment line-number">54.</span>    }  <br><span class="hljs-comment line-number">55.</span>    <span class="hljs-annotation">@Override</span>  <br><span class="hljs-comment line-number">56.</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">paint</span><span class="hljs-params">(Graphics g)</span></span>{  <br><span class="hljs-comment line-number">57.</span>        <span class="hljs-keyword">super</span>.paint(g);  <br><span class="hljs-comment line-number">58.</span>        g.drawImage(image, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>, <span class="hljs-keyword">null</span>);<span class="hljs-comment">//image为BufferedImage类型  </span><br><span class="hljs-comment line-number">59.</span>    }  <br><span class="hljs-comment line-number">60.</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{  <br><span class="hljs-comment line-number">61.</span>        T6Client frame = <span class="hljs-keyword">new</span> T6Client();  <br><span class="hljs-comment line-number">62.</span>        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);  <br><span class="hljs-comment line-number">63.</span>        frame.setVisible(<span class="hljs-keyword">true</span>);  <br><span class="hljs-comment line-number">64.</span>    }  <br><span class="hljs-comment line-number">65.</span>}  <br></code></pre></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>